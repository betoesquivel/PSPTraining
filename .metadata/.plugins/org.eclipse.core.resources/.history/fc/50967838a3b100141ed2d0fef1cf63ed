package mx.itesm.a01139626.p1.src;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;

public class FileLineSorter implements ErrorMessages{

	ArrayList<String> sArrFileNames;
	ArrayList<FileInfo> filArrFilesWithStats;
	
	public FileLineSorter(){
		
		sArrFileNames = new ArrayList<String>();
		filArrFilesWithStats = new ArrayList<FileInfo>();
		
	}
	
	public void addFileName(String s){
		sArrFileNames.add(s);
	}
	
	public boolean parseFiles(){

		// create the FileInfo s
		for (String sName : sArrFileNames){
			filArrFilesWithStats.add(new FileInfo(sName));
		}
		
		// parse the files
		for (FileInfo filFile : filArrFilesWithStats){
			filFile.parseFile();
			if (!filFile.isbExisting()) {
				return false; 
			}
		}
		
		return true; 
	}
	
	public void printFiles(){
		
		for (FileInfo filFile : filArrFilesWithStats){
			System.out.println(filFile);
			System.out.println("--------------------------------------------");
		}
	}
	
	public static void main(String[] args) throws IOException{
		BufferedReader bufIn = new BufferedReader(new InputStreamReader(System.in));
		Parser parValidator = new Parser();
		
		FileLineSorter filSorter = new FileLineSorter();
		String sFileNumber = null;
		int iFileNumber = 0; 
		
		// ask for how many files are to be sorted
		do {
			if (sFileNumber != null) {
				System.out.println(sINVALID_INTEGER);
			}
			System.out.println("Introduzca el numero de archivos a ordenar: ");
			sFileNumber = bufIn.readLine();
		
		} while (!parValidator.isNumeric(sFileNumber));
		
		iFileNumber = Integer.parseInt(sFileNumber);
		
		// ask for file names separated by a new line with extension
		System.out.println("Introduzca los nombres de los archivos a ordenar, separados por "
				+ "un salto de linea. (ejemplo: Archivo1.txt)");
		
		// read number of files from input
		int iCount = 0; 
		String sFName = null;
		boolean bValid = true; 
		
		do {
			if (sFName != null){
				System.out.println (sINVALID_FILE_NAME);
			}
			iCount = 0;
			bValid = true; 
			while (iCount < iFileNumber && bValid) {
				
				sFName = bufIn.readLine();
				bValid = parValidator.isValidFile(sFName);
				if (bValid){
					// add to file list
					filSorter.addFileName(sFName);
				} else {
					// reset file count
					iCount = 0; 
				}
				
				iCount++;
				
			}
		} while (iCount == 0); // keep reading until having at least one valid file

		// construct and parse all files in the file name arraylist
		if (filSorter.parseFiles()){
			// sort all files in FileInfo arraylist
			filSorter.filArrFilesWithStats.sort(new FileInfoComparator());
			// print all files in FileInfo arraylist
			filSorter.printFiles();
		}
		
		
	}

}
